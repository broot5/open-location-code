<!DOCTYPE html>
<!--
  This can be used to test the tile serving.
  In a browser, open this as a local file.
  You will have to start the app server instance without the host option, so that it
  will serve as "localhost".
-->
<html lang="en">
  <head>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.3.1/dist/ol.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v10.3.1/ol.css"
    />
    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script src="https://unpkg.com/maplibre-gl@^5.0.1/dist/maplibre-gl.js"></script>
    <link
      href="https://unpkg.com/maplibre-gl@^5.0.1/dist/maplibre-gl.css"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        font-family: "Roboto", sans-serif;
        font-weight: 100;
      }

      h2 {
        font-weight: 100;
      }

      .map {
        height: 600px;
      }

      #ol_geojson_code {
        background: white;
        border-radius: 2px;
        font-size: 24px;
        padding: 5px;
        position: absolute;
        text-align: center;
        top: 10px;
        left: 50px;
        min-width: 200px;
      }

      /* Tab styles */
      .tab-container {
        width: 100%;
        margin: 20px 0;
      }

      .tab-buttons {
        display: flex;
        gap: 2px;
        margin-bottom: 20px;
      }

      .tab-button {
        padding: 10px 20px;
        border: none;
        background: #f0f0f0;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      .tab-button:hover {
        background: #e0e0e0;
      }

      .tab-button.active {
        border-bottom: 2px solid #57c4d2;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }
    </style>
    <title>Tile layers examples</title>
  </head>

  <body>
    <script type="text/javascript">
      // Define the path to the Plus Code grid server.
      const gridServer = "http://localhost:8080/grid";

      // Tab functionality
      function openTab(evt, tabName) {
        const tabContents = document.getElementsByClassName("tab-content");
        const tabButtons = document.getElementsByClassName("tab-button");

        // Hide all tab contents
        for (let content of tabContents) {
          content.classList.remove("active");
        }

        // Deactivate all tab buttons
        for (let button of tabButtons) {
          button.classList.remove("active");
        }

        // Show the selected tab content and activate the button
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
      }
    </script>

    <div class="tab-container">
      <div class="tab-buttons">
        <button
          class="tab-button active"
          onclick="openTab(event, 'ol-geojson-wms')"
        >
          OpenLayers GeoJSON
        </button>
        <button class="tab-button" onclick="openTab(event, 'ol-image-tms')">
          OpenLayers Image
        </button>
        <button
          class="tab-button"
          onclick="openTab(event, 'leaflet-image-tms')"
        >
          Leaflet Image
        </button>
        <button class="tab-button" onclick="openTab(event, 'google-image-wms')">
          Google Maps API Image
        </button>
        <button class="tab-button" onclick="openTab(event, 'maplibre-mvt-wms')">
          MapLibre GL MVT
        </button>
      </div>

      <!-- OpenLayers GeoJSON WMS tiles section -->
      <section id="ol-geojson-wms" class="tab-content active">
        <h2>OpenLayers GeoJSON WMS tiles</h2>
        <p>
          Uses the option <code>zoomadjust=2</code> to fetch a more detailed
          grid level than the default.
        </p>
        <div style="position: relative">
          <div id="ol_geojson_wms" class="map"></div>
          <div id="ol_geojson_code">Click cell, get Plus Code</div>
        </div>

        <script type="text/javascript">
          // OpenLayers example, with GeoJSON WMS tiles.

          // Create the vector layer.
          const olGeojsonLayer = new ol.layer.VectorTile({
            source: new ol.source.VectorTile({
              maxZoom: 25,
              attributions:
                'grid by <a href="https://plus.codes">plus codes</a>',
              format: new ol.format.GeoJSON(),
              // Using WMS tile numbering.
              url: `${gridServer}/wms/{z}/{x}/{y}.json?zoomadjust=2`,
            }),
          });

          // Create the map, with Openstreetmap map tiles and the vector layer.
          const olGeojsonMap = new ol.Map({
            target: "ol_geojson_wms",
            layers: [
              new ol.layer.Tile({
                source: new ol.source.OSM(),
              }),
              olGeojsonLayer,
            ],
            view: new ol.View({
              center: ol.proj.fromLonLat([8.54, 47.5]),
              zoom: 4,
            }),
          });

          // Define an action so that clicking on the map will display the global code.
          const selectPointerMove = new ol.interaction.Select({
            condition: ol.events.condition.click,
          });

          selectPointerMove.on("select", (e) => {
            document.getElementById("ol_geojson_code").innerHTML = e.target
              .getFeatures()
              .getArray()[0]
              .get("global_code");
          });
          olGeojsonMap.addInteraction(selectPointerMove);
        </script>
      </section>

      <!-- OpenLayers image TMS tiles section -->
      <section id="ol-image-tms" class="tab-content">
        <h2>OpenLayers image TMS tiles</h2>
        <p>
          Uses the options
          <code>linecol=0xff0000ff&labelcol=0xff000060</code> to set the lines
          to red and the labels to a non-opaque red.
        </p>
        <div id="ol_image_tms" class="map"></div>

        <script type="text/javascript">
          // OpenLayers example, with Openstreetmap map tiles and TMS-numbered image tiles.
          const olImageMap = new ol.Map({
            target: "ol_image_tms",
            layers: [
              new ol.layer.Tile({
                source: new ol.source.OSM(),
              }),
              new ol.layer.Tile({
                source: new ol.source.XYZ({
                  attributions:
                    'grid by <a href="https://plus.codes">plus codes</a>',
                  // XYZ layers use WMS tile numbering, use -y for TMS.
                  url: `${gridServer}/tms/{z}/{x}/{-y}.png?linecol=0xff0000ff&labelcol=0xff000060`,
                }),
              }),
            ],
            view: new ol.View({
              center: ol.proj.fromLonLat([8.54, 47.5]),
              zoom: 4,
            }),
          });
        </script>
      </section>

      <!-- Leaflet image TMS tiles section -->
      <section id="leaflet-image-tms" class="tab-content">
        <h2>Leaflet image TMS tiles</h2>
        <p></p>
        <div id="ll_image_tms" class="map"></div>

        <script type="text/javascript">
          // Leaflet example, with Openstreetmap map tiles and TMS-numbered image tiles.
          const llImageMap = L.map("ll_image_tms", { maxZoom: 21 }).setView(
            [47.5, 8.54],
            4
          );

          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution:
              '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          }).addTo(llImageMap);

          L.tileLayer(`${gridServer}/tms/{z}/{x}/{y}.png`, {
            tms: true,
            attribution: 'grid by <a href="https://plus.codes">plus codes</a>',
          }).addTo(llImageMap);
        </script>
      </section>

      <!-- Google Maps API image WMS tiles section -->
      <section id="google-image-wms" class="tab-content">
        <h2>Google Maps API image WMS tiles</h2>
        <div id="g_image_wms" class="map"></div>

        <script type="text/javascript">
          // Google Maps API example, with WMS image tiles.
          const googleImageMap = new google.maps.Map(
            document.getElementById("g_image_wms"),
            {
              zoom: 4,
              center: { lat: 47.5, lng: 8.54 },
            }
          );

          const googleImageTiles = new google.maps.ImageMapType({
            getTileUrl: (coord, zoom) => {
              return `${gridServer}/wms/${zoom}/${coord.x}/${coord.y}.png`;
            },
            tileSize: new google.maps.Size(256, 256),
          });

          googleImageMap.overlayMapTypes.push(googleImageTiles);
        </script>
      </section>

      <!-- MapLibre GL JS MVT WMS tiles section -->
      <section id="maplibre-mvt-wms" class="tab-content">
        <h2>MapLibre GL JS MVT WMS tiles</h2>
        <div id="ml_mvt_wms" class="map"></div>

        <script type="text/javascript">
          // MapLibre GL JS example using MVT with WMS tile numbering
          const mlMvtMap = new maplibregl.Map({
            container: "ml_mvt_wms",
            style: {
              version: 8,
              sources: {
                osm: {
                  type: "raster",
                  tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
                  tileSize: 256,
                  attribution:
                    '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                },
                grid: {
                  type: "vector",
                  tiles: [`${gridServer}/wms/{z}/{x}/{y}.mvt`],
                  maxzoom: 22,
                  attribution:
                    'grid by <a href="https://plus.codes">plus codes</a>',
                },
              },
              layers: [
                {
                  id: "osm",
                  type: "raster",
                  source: "osm",
                  paint: {},
                },
                {
                  id: "grid",
                  type: "line",
                  source: "grid",
                  "source-layer": "grid",
                  paint: {
                    "line-color": "#FF0000",
                    "line-width": 1,
                  },
                },
              ],
            },
            center: [8.54, 47.5],
            zoom: 4,
          });
        </script>
      </section>
    </div>

    <script>
      // Initialize maps after tab change to ensure proper rendering
      const maps = {
        "ol-geojson-wms": olGeojsonMap,
        "ol-image-tms": olImageMap,
        "leaflet-image-tms": llImageMap,
        "google-image-wms": googleImageMap,
        "maplibre-mvt-wms": mlMvtMap,
      };

      // Update map size when tab is changed
      function updateMapSize(tabName) {
        if (maps[tabName]) {
          setTimeout(() => {
            // Handle different map types
            if (maps[tabName].updateSize) {
              // OpenLayers maps
              maps[tabName].updateSize();
            } else if (maps[tabName].invalidateSize) {
              // Leaflet maps
              maps[tabName].invalidateSize();
            } else {
              // Google Maps and MapLibre GL maps need to trigger resize
              window.dispatchEvent(new Event("resize"));
            }
          }, 100);
        }
      }

      // Add map update to tab change
      const originalOpenTab = openTab;
      openTab = function (evt, tabName) {
        originalOpenTab(evt, tabName);
        updateMapSize(tabName);
      };
    </script>
  </body>
</html>
